# Codex Code Review Agent

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π code review –¥–ª—è GitHub PR —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π best practices, bugs –∏ security.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π review** –Ω–∞ –∫–∞–∂–¥—ã–π PR –∏ push
‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:**
   - **Best Practices** ‚Äî —Å—Ç–∏–ª—å –∫–æ–¥–∞, –Ω–∞–∑–≤–∞–Ω–∏—è, SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã
   - **Bugs** ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, null checks, race conditions
   - **Security** ‚Äî SQL injection, XSS, —É—Ç–µ—á–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤
‚úÖ **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ PR** —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
‚úÖ **Status check** ‚Äî success/warning/failure
‚úÖ **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–π** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Rust, Go, Python, JavaScript, TypeScript, Java

## üìã –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ PR –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è workflow
2. –ü–æ–ª—É—á–∞–µ—Ç diff –∏–∑–º–µ–Ω–µ–Ω–∏–π (vs base branch)
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç Codex review —Å–∫—Ä–∏–ø—Ç
4. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–¥ –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –æ—à–∏–±–æ–∫
5. –°–æ–∑–¥–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ PR —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
6. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç status check (Codex Review)

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã

```bash
mkdir -p .github/workflows .github/scripts
```

–§–∞–π–ª—ã:
- `.github/workflows/codex-review.yml` ‚Äî GitHub Actions workflow
- `.github/scripts/codex-review.py` ‚Äî –°–∫—Ä–∏–ø—Ç review (–∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π)

### 2. –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git add .github/
git commit -m "Add Codex code review workflow"
git push
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GitHub Permissions

Workflow —Ç—Ä–µ–±—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ permissions:
- `pull-requests: write` ‚Äî –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ PR
- `contents: read` ‚Äî –¥–ª—è —á—Ç–µ–Ω–∏—è –∫–æ–¥–∞

–≠—Ç–∏ permissions —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –≤ workflow.

## üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

### PR Comment

```
## üîç Codex Code Review

**Repository:** voloshko/argo-rust
**PR:** #42
**Commit:** `abc123`

### üìã Review Summary

| Severity | Category | File | Line | Issue |
|----------|----------|------|------|--------|
| ‚ö†Ô∏è | best-practices | src/main.rs:7 | Consider using proper error handling instead of unwrap() |
| ‚ùå | bugs | src/main.rs:12 | Avoid panic! in production code |

---

**Categories checked:**
‚úÖ **Best Practices** - Code style, naming conventions, SOLID principles
‚úÖ **Bugs** - Logic errors, null checks, off-by-one, race conditions
‚úÖ **Security** - SQL injection, XSS, auth issues, secrets in code

*Generated by Codex Agent* ü§ñ
```

### Status Check

```
‚úÖ Codex Review - No issues found
‚ö†Ô∏è Codex Review - Warnings found
‚ùå Codex Review - Critical issues found
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.github/scripts/codex-review.py`:

```python
PATTERNS = {
    'rust': {
        'best_practices': [
            (r'my_pattern', 'My custom message'),
        ],
        'security': [
            (r'secret_pattern', 'Don\'t include secrets'),
        ],
    },
}
```

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —è–∑—ã–∫

```python
lang_map = {
    '.rs': 'rust',
    '.mylang': 'mylang',
}
```

–ò –¥–æ–±–∞–≤—å—Ç–µ PATTERNS –¥–ª—è 'mylang'.

## üéØ –¢—Ä–∏–≥–≥–µ—Ä—ã

Workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞:

- **Push** –≤: `main`, `master`, `develop`
- **Pull Request** (opened, synchronize, reopened)

## üîß –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ review —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é

```bash
# –°–æ–∑–¥–∞—Ç—å diff
git diff origin/main...HEAD > my_diff.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å review
python3 .github/scripts/codex-review.py \
  --diff my_diff.txt \
  --format json \
  --output review.json
```

### –í—ã–≤–æ–¥ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

```bash
python3 .github/scripts/codex-review.py --diff my_diff.txt --format text
```

## üìà –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM

–î–ª—è –±–æ–ª–µ–µ —É–º–Ω–æ–≥–æ review –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å LLM –∞–Ω–∞–ª–∏–∑:

```python
import openai

def analyze_with_llm(code):
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are a code reviewer."},
            {"role": "user", "content": f"Review this code:\n{code}"}
        ]
    )
    return response.choices[0].message.content
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ unit test –ø—Ä–æ–≤–µ—Ä–∫–∏

```python
def check_test_coverage(hunk):
    # Parse and check for test coverage
    pass
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ permissions –≤ repository settings:
1. Settings ‚Üí Actions ‚Üí General
2. –†–∞–∑—Ä–µ—à–∏—Ç—å "Allow all actions and reusable workflows"
3. –†–∞–∑—Ä–µ—à–∏—Ç—å "Read and write permissions" –¥–ª—è GITHUB_TOKEN

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ workflow:
1. Actions tab –≤ GitHub
2. –í—ã–±–µ—Ä–∏—Ç–µ Codex Code Review run
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ "Comment on PR" step

### –õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ PATTERNS:

```python
PATTERNS = {
    'rust': {
        'best_practices': [
            (r'unwrap\(\)', 'Consider using proper error handling', False),  # False = disable
        ],
    },
}
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License ‚Äî —Å–≤–æ–±–æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å.
